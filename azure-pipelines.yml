jobs:

  - job: Cypress_e2e_tests
    pool: default
    steps:
      - task: NodeTool@0
        inputs:
          versionSpec: '16.19.0'
        displayName: 'Install Node.js'
      
      - task: Bash@3
        inputs:
          script: 'apt-get install libgtk2.0-0 libgtk-3-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2 libxtst6 xauth xvfb'

      - task: CacheBeta@1
        inputs:
          key: npm | $(Agent.OS) | package-lock.json
          path: /home/vsts/.npm
          restoreKeys: npm | $(Agent.OS) | package-lock.json
        displayName: Cache NPM packages
      - task: CacheBeta@1
        inputs:
          key: cypress | $(Agent.OS) | package-lock.json
          path: /home/vsts/.cache/Cypress
          restoreKeys: cypress | $(Agent.OS) | package-lock.json
        displayName: Cache Cypress binary

      - script: npm install
        displayName: 'Install NPM dependencies'

      - script: npm run cy:run
        displayName: 'Run Cypress tests'